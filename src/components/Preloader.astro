<!-- see: https://www.youtube.com/watch?v=-HS9IIuT_Mo&t=418s -->
<!-- or, if you want something fancier https://www.youtube.com/watch?v=Gx35fMhDPWs -->

<!-- might need to do something to disable scroll while preloader is showing -->


<div class="loader loader--blank"></div>

<!-- try is:inline here so it loads quicker (and before the google map stuff) -->
<script is:inline>

    // try something like this
    // (it's ok we don't need cookie consent to do this!)
    // (sesion storage is considered strictly necessary)
    // https://stackoverflow.com/questions/48054601/how-to-show-website-preloader-only-once

    // right, what's gonna happen with the preloader is this.
    // if it takes more than a certain time to load, we add a --loading class to the preloader div
    // the --loading class has the ::after so the spinner appears
    // and a transition rule, so it fades when the --hidden class is applied

    // otherwise the window load event will just add the --hidden class to the preloader div
    // and the transition (fade) will happen every time you reload the page or go to a new page

    // think the best option is to make the loader blank (tried white, the dark blue is better) 
    // up until it's required to start looking like a loader
    // then it'll cover the ugly stuff but not flash up like a loader when load is instantaneous

    // NB don't get thrown by the blue background that will always flash before the hero image is loaded

    // yeah this way is not that different to no loader when load is instant, just that the nav disappears momentarily
    // this'll do for now

    // remove session storage item for testing
    // console.log(`storage item removed`);
    // sessionStorage.removeItem('preloadComplete');
    // console.log(`session storage item is now: ${sessionStorage.getItem('preloadComplete')}`);

    const preLoader = document.querySelector('.loader');

    // if preloadComplete hasn't been set yet
    // go ahead and show the loader
    // (add loader--loading to the classlist)

    // so ensure loader is hidden to start off with in <style>

    if (!sessionStorage.getItem('preloadComplete')) {

        // only add the loader--loading class if we need the loader
        // because that class adds the transition
        // we don't want the transition happening every time a new page loads
        // loader--loading also adds the animation, using ::after
        preLoader.classList.add('loader--loading');
        console.log(`loader is now loader--loading because preloadComplete is: ${sessionStorage.getItem('preloadComplete')}`);
        
        window.addEventListener('load', () => {

            // clear the timeout, so the --loading class doesn't get added
            // so there won't be a transition when the --hidden class gets added
            // clearTimeout(startLoaderTimeout);
            // console.log(`the timeout cleared!`);

            preLoader.classList.add('loader--hidden');
            console.log(`load event fired!`);

            sessionStorage.setItem('preloadComplete', 'true');
            console.log(`preloadComplete is now: ${sessionStorage.getItem('preloadComplete')}`);

        });

        console.log(`load event listener added`);

    } else {
        console.log(`loader is not showing because preloadComplete is: ${sessionStorage.getItem('preloadComplete')}`);
        // hide the loader
        preLoader.classList.add('loader--hidden');
        // something
        // set sessionStorage item at some point
    }

    // console.log("preloader script running");

</script>

<style>

    /* NB google maps z-index appears to be 1000000 plus a few; */
    /* so I suppose we're gonna have to go 1000100 or maybe 2000000! */

    .loader {
        position: fixed;
        z-index: 1000100;
        inset: 0;
        background-color: hsl(var(--darkergrey));
        /* border: 1px solid hotpink; */
        color: hsl(var(--white));
        width: 100vw;
        height: 100vh;
        align-items: center;
        justify-content: center;
        display: flex;
    }

    .loader--loading {
        /* background-color: hsl(var(--darkergrey)); */
        /* visibility isn't transitionable? */
        /* transition: opacity 0.5s, visibility 0.5s; */
        background-color: hsl(var(--darkblue));
        transition: opacity 0.5s;
    }

    .loader--loading::after {
        content: '';
        display: flex;
        width: 70px;
        height: 70px;
        border: 5px solid hsl(var(--lightbluegrey));
        /* border-top-color so a quarter of the circle is a different colour */
        border-top-color: hsl(var(--white));
        border-radius: 50%;

        animation: loading 0.75s linear infinite;
    }

    @keyframes loading {
        from { transform: rotate(0turn) }
        to { transform: rotate(1turn) }
    }

    .loader--hidden {
        opacity: 0;
        visibility: hidden;
    }
    
</style>